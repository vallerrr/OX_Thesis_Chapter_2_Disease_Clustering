import warnings
from pathlib import Path

import pandas as pd

#  paths
current_path = Path.cwd()
recorder_path = current_path/'Data/downloaded_data/recorder'
codebook_path = current_path/'Data/codebook'
participant_path = current_path/'Data/downloaded_data/participant'
preprocessed_path = current_path/'Data/preprocessed_data'
intermediate_path = current_path/'Data/intermediate_files'
# recoding section
cate_names = ['Cognitive function summary', 'Lifestyle', 'Socio-demographics', 'Early life', 'Health outcomes', 'Physical measures', 'Family history', 'Education and employment']
codebook_basic_columns = ['field_name', 'cate_name', 'field_id', 'cate_id', 'original_cat','ids_count', 'instance_count', 'array_count', 'ids', 'instance','array', 'file_names', 'recode_type','replace_dict','preprocessed_flag', 'note']
replace_dict_basics = {'half': 0.5, '6+': 6, '2-4 times a week': 2, 'Once a week': 1, 'Never': 0, '5-6 times a week': 3, 'Once or more daily': 4, 'Sometimes': 2, 'Never/rarely': 0.0, 'Usually': 2.0, 'Always': 3.0, '52,000 to 100,000': 4.0, '18,000 to 30,999': 2.0, 'Greater than 100,000': 5.0, '31,000 to 51,999': 3.0, 'Less than 18,000': 1.0, 'Two': 2.0, 'One': 1.0, 'Three': 3.0, 'Four or more': 4.0, 'Rent - from private landlord or letting agency': 2.5, 'Own outright (by you or someone in your household)': 0.5, 'Own with a mortgage': 1.0, 'Rent - from local authority, local council, housing association': 3.0, 'Live in accommodation rent free': 2.0, 'Pay part rent and part mortgage (shared ownership)': 1.5, 'None of the above': None, 'Mobile or temporary structure (i.e. caravan)': 3.0, 'Sheltered accommodation': 4.0, 'A flat, maisonette or apartment': 2.0, 'A house or bungalow': 1.0, 'Care home': 4.0, 'May': 5.0, 'September': 9.0, 'April': 4.0, 'November': 11.0, 'January': 1.0, 'June': 6.0, 'February': 2.0, 'August': 8.0, 'July': 7.0, 'March': 3.0, 'October': 10.0, 'December': 12.0, 'Female': 0.0, 'Male': 1.0, 'Yes - pounds and ounces': 0.453592, 'Yes - Kilograms': 1.0, 'About average': 1.0, 'Thinner': 0.5, 'Plumper': 2.0, 'Shorter': 0.5, 'Taller': 2.0, 'Right-handed': 3.0, 'Left-handed': 2.0, 'Use both right and left hands equally': 1.0, 'No, I am unable to do this': 0.0, 'I can only hear on the left side': 0.5, 'I can only hear on the right side': 0.5, 'yes': 1.0, 'no': 0.0, 'abandon': 0.0, '10%': 0.1, '20%': 0.2, '40%': 0.4, '70%': 0.7, '100% (max)': 1.0, 'Unreliable due to unexpectedly small size': -1.0, 'Unreliable due to unexpectedly large size': 1.0, 'normal': 0.0, 'high possibility of abnormality': 1.0, 'doubtful': 0.5, 'Unsure': 0.5, 'highly myopic': 1.0, 'moderate/low myopia': 0.5, 'non-myopic': 0.0, 'Less than once a week': 0.5, 'Less than a year': 0.5, '3 or 4': 3.5, '1 or 2': 1.5, '7, 8 or 9': 8.0, '5 or 6': 5.5, '10 or more': 10.0, 'Yes, but not in the last year': 0.5, 'Yes, during the last year': 1.0, 'Less than monthly': 0.1, 'Monthly': 0.25, 'Weekly': 1.0, 'Daily or almost daily': 7.0, '4 or more times a week': 4.5, '2 to 3 times a week': 2.5, '2 to 4 times a month': 0.375, 'Monthly or less': 0.25, "['Talking therapies, such as psychotherapy, counselling, group therapy or CBT']": 1.0, "['Talking therapies, such as psychotherapy, counselling, group therapy or CBT', 'Other therapeutic activities such as mindfulness, yoga or art classes']": 1.0, "['Other therapeutic activities such as mindfulness, yoga or art classes']": 1.0, 'Rarely': 1.0, 'A little': 1.0, 'Somewhat': 2.0, 'A lot': 3.0, 'All my life / as long as I can remember': 500.0, 'Several days': 1.0, 'Nearly every day': 3.0, 'More than half the days': 2.0, 'Yes, more than 100 times': 6.0, 'Yes, 1-2 times': 1.0, 'Yes, 3-10 times': 2.0, 'Yes, 11-100 times': 3.0, 'Once a week or more, but not every day': 3.0, 'Less than once a month': 0.25, 'Once a month or more, but not every week': 0.75, "['Prefer not to answer']": None, 'Not applicable': 0.0, 'Between one and three months': 2.0, 'One to two years': 18.0, 'Over two years': 24.0, 'Over six months, but less than 12 months': 10.0, 'Less than a month': 0.1, 'Over three months, but less than six months': 0.4, 'All day long': 1.0, 'About half of the day': 0.5, 'Most of the day': 0.8, 'Less than half of the day': 0.3, "['Unprescribed medication (more than once)']": 1.0, "['Drugs or alcohol (more than once)']": -1.0, "['Unprescribed medication (more than once)', 'Medication prescribed to you (for at least two weeks)']": 1.0, "['Unprescribed medication (more than once)', 'Medication prescribed to you (for at least two weeks)', 'Drugs or alcohol (more than once)']": 0.0, "['Medication prescribed to you (for at least two weeks)', 'Drugs or alcohol (more than once)']": 0.0, "['Medication prescribed to you (for at least two weeks)']": 1.0, "['Unprescribed medication (more than once)', 'Drugs or alcohol (more than once)']": -1.0, 'Stayed about the same or was on a diet': 0.0, 'Both gained and lost some weight during the episode': 1.0, 'Gained weight': 1.0, 'Lost weight': 1.0, 'Not bothered at all': 0.0, 'Bothered a lot': 2.0, 'Bothered a little': 1.0, '0 - Not at all': 0.0, '10 - Completely': 10.0, 'Most of the time': 2.5, 'Two to three days a month': 0.5, 'One day a month': 0.25, 'Every day': 7.0, 'Less than one day a month': 0.1, 'One day a week': 1.0, 'More than one day a week': 3.0, '5 days with pain': 5.0, '2 days with pain': 2.0, '7 days with pain': 7.0, '9 days with pain': 9.0, '10 days with pain': 10.0, '3 days with pain': 3.0, '8 days with pain': 8.0, '6 days with pain': 6.0, '1 day with pain': 1.0, '4 days with pain': 4.0, 'No days with pain': 0.0, '10 - Very unhappy': 10.0, '0 - Very happy': 0.0, '0 - No distension': 0.0, '10 - Very severe distension': 10.0, '10 - Very severe pain': 10.0, '0 - No pain': 0.0, 'Right eye only': 1.0, 'Left eye only': 1.0, 'Both eyes': 2.0, 'Yes, but more than 4 weeks ago': 2.0, 'Yes, in last 4 weeks': 3.0, 'Possibly, but more than 4 weeks ago': 1.0, "['Diabetes related eye disease', 'Injury or trauma resulting in loss of vision', 'Macular degeneration', 'Other serious eye condition']": 1.0, "['Glaucoma', 'Injury or trauma resulting in loss of vision', 'Cataract', 'Macular degeneration']": 1.0, "['Glaucoma', 'Injury or trauma resulting in loss of vision']": 1.0, "['Diabetes related eye disease', 'Glaucoma', 'Macular degeneration']": 1.0, "['Glaucoma', 'Injury or trauma resulting in loss of vision', 'Cataract', 'Macular degeneration', 'Other serious eye condition']": 1.0, "['Glaucoma', 'Cataract', 'Macular degeneration']": 1.0, "['Diabetes related eye disease', 'Glaucoma', 'Cataract', 'Other serious eye condition']": 1.0, "['Macular degeneration']": 1.0, "['Glaucoma', 'Cataract']": 1.0, "['Cataract', 'Other serious eye condition']": 1.0, "['Diabetes related eye disease', 'Injury or trauma resulting in loss of vision', 'Cataract', 'Other serious eye condition']": 1.0, "['Diabetes related eye disease', 'Injury or trauma resulting in loss of vision', 'Cataract']": 1.0, "['Cataract', 'Macular degeneration', 'Other serious eye condition']": 1.0, 'Do not remember': 30.9, 'Still taking HRT': 1.0, 'Still taking the pill': 1.0, 'Not sure': None, 'Only had twins': 7.01, 'Less than 1 year ago': 0.5, 'Less than a year ago': 0.5, 'Only one fall': 1.0, 'No falls': 0.0, 'More than one fall': 2.0, 'Good': 2.0, 'Excellent': 3.0, 'Poor': 0.0, 'Fair': 1.0, 'No - weigh about the same': 0.0, 'Yes - lost weight': -1.0, 'Yes - gained weight': 1.0, 'A moderate amount': 2.0, 'An extreme amount': 4.0, 'Very much': 3.0, 'Moderately happy': 1.0, 'Very unhappy': -2.0, 'Moderately unhappy': -1.0, 'Extremely unhappy': -3.0, 'Extremely happy': 3.0, 'Very happy': 2.0, 'I am completely deaf': 2.0, 'Yes, for around 1-5 years': 2.0, 'Yes, for more than 5 years': 3.0, 'Yes, for less than a year': 1.0, 'Yes, now a lot of the time': 3.0, 'No, never': 0.0, 'Yes, but not now, but have in the past': 1.0, 'Yes, now some of the time': 2.0, 'Yes, now most or all of the time': 4.0, 'Severely': 3.0, 'Slightly': 1.0, 'A week or more': 7.0, 'At least a day, but less than a week': 3.5, 'Less than 24 hours': 1.0, 'No problems': 0.0, 'Needed treatment or caused problems with work, relationships, finances, the law or other aspects of life.': 1.0, 'Yes - you will be asked about this later by an interviewer': 1.0, 'No cigarettes, only smoke cigars or pipes': 0.0, 'Less than one cigarette per day': 0.5, 'At least two days, but less than a week': 3.5, 'Less than a week': 3.0, 'Needed treatment or caused problems with work, relationships, finances, the law or other aspects of life': 1.0, 'No': 0.0, 'Yes': 1.0, 'Do not know': None, 'Yes, more than once': 2.0, 'Yes, once': 1.0, '3 or more': 3.0, "['Yes']": 1.0, "['Yes', 'No']": 0.5, "['Yes', 'No', 'Not known']": 0.5, "['Not known']": 0.0, "['Yes', 'Not known']": 0.75, "['No']": 0.0, "['No', 'Not known']": 0.0, 'Never true': 0.0, 'Very often true': 4.0, 'Prefer not to answer': None, 'Sometimes true': 2.0, 'Often': 3.0, 'Rarely true': 1.0, 'Yes, within the last 12 months': 1.0, 'Yes, but not in the last 12 months': 2.0, 'Not at all': 0.0, 'A little bit': 1.0, 'Moderately': 3.0, 'Extremely': 4.0, 'Quite a bit': 2.0, 'Too many to count': 80.0}

def clean_replace_dict(replace_dict_basics):
    keys_to_remove = []
    for key in replace_dict_basics.keys():
        try:
            float_key = float(key)
            keys_to_remove.append(key)
        except:
            continue
    for key in keys_to_remove:
        replace_dict_basics.pop(key)
    return replace_dict_basics

replace_dict_basics=clean_replace_dict(replace_dict_basics)

